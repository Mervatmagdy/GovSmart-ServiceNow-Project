<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope, $http, $window) {
  var c = this;

  if (c.data.isLoggedIn) {
    $window.location = '?id=index';
    return;
  }

  c.login = function() {
    c.loggingIn = true;
    c.data.error = null;

    c.server.get({
      action: 'lookup_user',
      national_id: c.national_id
    }).then(function(r) {
 
      if (r.data.error) {
        c.loggingIn = false;
        c.data.error = r.data.error;
        return;
      }

  
      performLogin(r.data.found_username, c.password);
    });
  };

  function performLogin(realUserName, password) {
    var params = {
      user_name: realUserName, 
      user_password: password,
      action: 'glidedesigner',
      sys_action: 'sysverb_login'
    };

    $http.post('/login.do', params, {
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      transformRequest: function(obj) {
        var str = [];
        for (var p in obj)
          str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
        return str.join("&");
      }
    }).then(function(response) {
      var respHTML = response.data;
      if (respHTML.indexOf("sysverb_login") > -1 || respHTML.indexOf("login_cpw") > -1) {
        c.loggingIn = false;
        c.data.error = "Invalid Password."; 
      } else {
        $window.location = "?id=index";
      }
    }, function(err) {
      c.loggingIn = false;
      c.data.error = "Connection error.";
    });
  }
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.auth-container {&#13;
  display: flex;&#13;
  justify-content: center;&#13;
  align-items: center;&#13;
  min-height: 70vh;&#13;
}&#13;
&#13;
.auth-panel {&#13;
  width: 100%;&#13;
  max-width: 400px;&#13;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);&#13;
  border: none;&#13;
  border-radius: 8px;&#13;
}&#13;
&#13;
.panel-heading {&#13;
  background-color: #2b6cb0 !important; &#13;
  color: white !important;&#13;
  border-radius: 8px 8px 0 0;&#13;
  padding: 15px;&#13;
}&#13;
&#13;
.input-group-addon {&#13;
  background-color: #f0f2f5;&#13;
  border-color: #e2e8f0;&#13;
}&#13;
&#13;
.btn-primary {&#13;
  background-color: #2b6cb0;&#13;
  border: none;&#13;
  margin-top: 10px;&#13;
}&#13;
&#13;
.btn-primary:hover {&#13;
  background-color: #1a365d;&#13;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>govlogin</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>GovLigin</name>
        <option_schema/>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function() {
  data.isLoggedIn = gs.getSession().isLoggedIn();
  

  if (input && input.action === 'lookup_user') {
    var grUser = new GlideRecord('sys_user');
    grUser.addQuery('u_national_id', input.national_id); 
    grUser.addActiveQuery();
    grUser.query();
    
    if (grUser.next()) {
      data.found_username = grUser.getValue('user_name');
    } else {
      data.error = "National ID not found.";
    }
  }
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-04 18:00:15</sys_created_on>
        <sys_id>6b629f24831afad078c11a30ceaad356</sys_id>
        <sys_mod_count>12</sys_mod_count>
        <sys_name>GovLigin</sys_name>
        <sys_package display_value="GovSmart Review &amp;amp; Visit Management System" source="x_1850706_govsma_0">e0e99de183fdf21078c11a30ceaad3e5</sys_package>
        <sys_policy/>
        <sys_scope display_value="GovSmart Review &amp;amp; Visit Management System">e0e99de183fdf21078c11a30ceaad3e5</sys_scope>
        <sys_update_name>sp_widget_6b629f24831afad078c11a30ceaad356</sys_update_name>
        <sys_updated_by>mina.admin</sys_updated_by>
        <sys_updated_on>2026-01-13 17:24:40</sys_updated_on>
        <template><![CDATA[<div class="auth-container">
  <div class="panel panel-default auth-panel">
    <div class="panel-heading">
      <h3 class="panel-title text-center">
        <i class="fa fa-id-card"></i> Login via National ID
      </h3>
    </div>
    <div class="panel-body">
      
      <div ng-if="c.data.error" class="alert alert-danger">
        {{c.data.error}}
      </div>

      <form ng-submit="c.login()">
        <div class="form-group">
          <label>National ID</label>
          <div class="input-group">
            <span class="input-group-addon"><i class="fa fa-id-badge"></i></span>
            <input type="text" class="form-control" ng-model="c.national_id" placeholder="Enter National ID" required>
          </div>
        </div>

        <div class="form-group">
          <label>Password</label>
          <div class="input-group">
            <span class="input-group-addon"><i class="fa fa-lock"></i></span>
            <input type="password" class="form-control" ng-model="c.password" placeholder="Enter Password" required>
          </div>
        </div>

        <button type="submit" class="btn btn-primary btn-block btn-lg">
          <span ng-if="!c.loggingIn">Login</span>
          <span ng-if="c.loggingIn"><i class="fa fa-spinner fa-spin"></i> Verifying...</span>
        </button>
      </form>
    </div>
    
    <div class="panel-footer text-center">
      <p>Don't have an account? <a href="?id=registration_page">Register Now</a></p>
    </div>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
