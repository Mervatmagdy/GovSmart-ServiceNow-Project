<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope, $http, $window) {
  var c = this;
  
  // 1. التحقق لو المستخدم مسجل دخول أصلاً -> حوله لصفحة Home
  if (c.data.isLoggedIn) {
    $window.location = '?id=index'; // تأكد إن id الصفحة الرئيسية عندك هو home
    return; 
  }

  c.loggingIn = false;

  c.login = function() {
    c.loggingIn = true;
    c.data.error = null;

    var params = {
      user_name: c.username,
      user_password: c.password,
      action: 'glidedesigner',
      sys_action: 'sysverb_login'
    };

    $http.post('/login.do', params, {
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      transformRequest: function(obj) {
        var str = [];
        for (var p in obj)
          str.push(encodeURIComponent(p) + "=" + encodeURIComponent(obj[p]));
        return str.join("&");
      }
    }).then(function(response) {
      if (response.data.indexOf("logout") > -1 || response.data.indexOf("sysparm_url") > -1) {
        $window.location = "?id=index";
      } else {
        c.loggingIn = false;
        c.data.error = "Invalid username or password.";
      }
    }, function() {
      c.loggingIn = false;
      c.data.error = "An error occurred.";
    });
  };
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.auth-container {&#13;
  display: flex;&#13;
  justify-content: center;&#13;
  align-items: center;&#13;
  min-height: 70vh; /* عشان تيجي في نص الشاشة */&#13;
}&#13;
&#13;
.auth-panel {&#13;
  width: 100%;&#13;
  max-width: 400px; /* حجم مناسب للفورم */&#13;
  box-shadow: 0 4px 15px rgba(0,0,0,0.1);&#13;
  border: none;&#13;
  border-radius: 8px;&#13;
}&#13;
&#13;
.panel-heading {&#13;
  background-color: #2b6cb0 !important; /* نفس لون موقعك الأزرق */&#13;
  color: white !important;&#13;
  border-radius: 8px 8px 0 0;&#13;
  padding: 15px;&#13;
}&#13;
&#13;
.input-group-addon {&#13;
  background-color: #f0f2f5;&#13;
  border-color: #e2e8f0;&#13;
}&#13;
&#13;
.btn-primary {&#13;
  background-color: #2b6cb0;&#13;
  border: none;&#13;
  margin-top: 10px;&#13;
}&#13;
&#13;
.btn-primary:hover {&#13;
  background-color: #1a365d;&#13;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>govlogin</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {
  
}]]></link>
        <name>GovLigin</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
  // نتحقق من حالة الدخول ونرسل النتيجة للـ Client
  data.isLoggedIn = gs.getSession().isLoggedIn();
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-04 18:00:15</sys_created_on>
        <sys_id>6b629f24831afad078c11a30ceaad356</sys_id>
        <sys_mod_count>3</sys_mod_count>
        <sys_name>GovLigin</sys_name>
        <sys_package display_value="GovSmart Review &amp;amp; Visit Management System" source="x_1850706_govsma_0">e0e99de183fdf21078c11a30ceaad3e5</sys_package>
        <sys_policy/>
        <sys_scope display_value="GovSmart Review &amp;amp; Visit Management System">e0e99de183fdf21078c11a30ceaad3e5</sys_scope>
        <sys_update_name>sp_widget_6b629f24831afad078c11a30ceaad356</sys_update_name>
        <sys_updated_by>mina.admin</sys_updated_by>
        <sys_updated_on>2026-01-04 18:07:44</sys_updated_on>
        <template><![CDATA[<div class="auth-container">
  <div class="panel panel-default auth-panel">
    <div class="panel-heading">
      <h3 class="panel-title text-center">
        <i class="fa fa-sign-in"></i> Login to Government Services
      </h3>
    </div>
    <div class="panel-body">
      
      <div ng-if="c.data.error" class="alert alert-danger">
        {{c.data.error}}
      </div>

      <form ng-submit="c.login()">
        <div class="form-group">
          <label>Username</label>
          <div class="input-group">
            <span class="input-group-addon"><i class="fa fa-user"></i></span>
            <input type="text" class="form-control" ng-model="c.username" placeholder="Enter Username" required>
          </div>
        </div>

        <div class="form-group">
          <label>Password</label>
          <div class="input-group">
            <span class="input-group-addon"><i class="fa fa-lock"></i></span>
            <input type="password" class="form-control" ng-model="c.password" placeholder="Enter Password" required>
          </div>
        </div>

        <button type="submit" class="btn btn-primary btn-block btn-lg">
          <span ng-if="!c.loggingIn">Login</span>
          <span ng-if="c.loggingIn"><i class="fa fa-spinner fa-spin"></i> Verifying...</span>
        </button>
      </form>
    </div>
    
    <div class="panel-footer text-center">
      <p>Don't have an account? <a href="?id=registration_page">Register Now</a></p>
    </div>
  </div>
</div>]]></template>
    </sp_widget>
</record_update>
